!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CameraControls=e()}(this,function(){"use strict";var t=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._listeners={}}return t.prototype.addEventListener=function(t,e){var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},t.prototype.hasEventListener=function(t,e){var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},t.prototype.removeEventListener=function(t,e){var i=this._listeners[t];if(void 0!==i){var o=i.indexOf(e);-1!==o&&i.splice(o,1)}},t.prototype.dispatchEvent=function(t){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),o=0,a=i.length;o<a;o++)i[o].call(this,t)}},t}();var E=void 0,b=void 0,A=void 0,x=void 0,a=void 0,r=void 0,w=void 0,M=void 0,D=void 0,h=.001,j=-1,S=0,L=1,T=2,F=3,z=4,C=5;function e(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function n(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}return function(f){function y(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,f.call(this));if(o.object=t,o.enabled=!0,o._state=j,o.minDistance=0,o.maxDistance=1/0,o.minZoom=0,o.maxZoom=1/0,o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minAzimuthAngle=-1/0,o.maxAzimuthAngle=1/0,o.dampingFactor=.05,o.draggingDampingFactor=.25,o.dollySpeed=1,o.truckSpeed=2,o.dollyToCursor=!1,o.verticalDragToForward=!1,o.domElement=e,o._target=new E.Vector3,o._targetEnd=new E.Vector3,o._spherical=new E.Spherical,o._spherical.setFromVector3(o.object.position),o._sphericalEnd=(new E.Spherical).copy(o._spherical),o._target0=o._target.clone(),o._position0=o.object.position.clone(),o._zoom0=o.object.zoom,o._needsUpdate=!0,o.update(),!o.domElement||i.ignoreDOMEventListeners)o._removeAllEventListeners=function(){};else{var l=function(t,e){if(e.set(0,0),t.touches){for(var i=0;i<t.touches.length;i++)e.x+=t.touches[i].clientX,e.y+=t.touches[i].clientY;return e.x/=t.touches.length,e.y/=t.touches.length,e}return e.set(t.clientX,t.clientY),e},a=function(t){if(m.enabled){t.preventDefault();var e=m._state;switch(t.button){case E.MOUSE.LEFT:m._state=S;break;case E.MOUSE.MIDDLE:m._state=L;break;case E.MOUSE.RIGHT:m._state=T}e!==m._state&&h(t)}},r=function(t){if(m.enabled){t.preventDefault();var e=m._state;switch(t.touches.length){case 1:m._state=F;break;case 2:m._state=z;break;case 3:m._state=C}e!==m._state&&h(t)}},n=function(t){if(m.enabled){t.preventDefault();var e=0===navigator.platform.indexOf("Mac")?-1:-3,i=void 0;i=void 0!==t.wheelDelta?t.wheelDelta/120:1===t.deltaMode?t.deltaY/e:t.deltaY/(10*e);var o=void 0,a=void 0;m.dollyToCursor&&(v=m.domElement.getBoundingClientRect(),o=(t.clientX-v.left)/v.width*2-1,a=(t.clientY-v.top)/v.height*-2+1),u(-i,o,a)}},s=function(t){m.enabled&&t.preventDefault()},h=function(t){if(m.enabled){if(t.preventDefault(),l(t,b),v=m.domElement.getBoundingClientRect(),g.copy(b),m._state===z){var e=b.x-t.touches[1].pageX,i=b.y-t.touches[1].pageY,o=Math.sqrt(e*e+i*i);_.set(0,o);var a=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);g.set(a,r)}document.addEventListener("mousemove",c,{passive:!1}),document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("mouseup",p),document.addEventListener("touchend",p),m.dispatchEvent({type:"controlstart",originalEvent:t})}},c=function(t){if(m.enabled){t.preventDefault(),l(t,b);var e=g.x-b.x,i=g.y-b.y;switch(g.copy(b),m._state){case S:case F:var o=2*Math.PI*e/v.width,a=2*Math.PI*i/v.height;m.rotate(o,a,!0);break;case L:break;case z:var r=b.x-t.touches[1].pageX,n=b.y-t.touches[1].pageY,s=Math.sqrt(r*r+n*n),h=_.y-s,c=m.dollyToCursor?(g.x-v.left)/v.width*2-1:0,p=m.dollyToCursor?(g.y-v.top)/v.height*-2+1:0;u(h/8,c,p),_.set(0,s),d(e,i);break;case T:case C:d(e,i)}m.dispatchEvent({type:"control",originalEvent:t})}},p=function t(){m.enabled&&(m._state=j,document.removeEventListener("mousemove",c),document.removeEventListener("touchmove",c),document.removeEventListener("mouseup",t),document.removeEventListener("touchend",t),m.dispatchEvent({type:"controlend",originalEvent:event}))},d=function(t,e){if(m.object.isPerspectiveCamera){var i=A.copy(m.object.position).sub(m._target),o=m.object.fov*E.Math.DEG2RAD,a=i.length()*Math.tan(o/2),r=m.truckSpeed*t*a/v.height,n=m.truckSpeed*e*a/v.height;m.verticalDragToForward?(m.truck(r,0,!0),m.forward(-n,!0)):m.truck(r,n,!0)}else if(m.object.isOrthographicCamera){var s=t*(m.object.right-m.object.left)/m.object.zoom/v.width,h=e*(m.object.top-m.object.bottom)/m.object.zoom/v.height;m.truck(s,h,!0)}},u=function(t,e,i){var o=Math.pow(.95,-t*m.dollySpeed);if(m.object.isPerspectiveCamera){var a=m._sphericalEnd.radius*o-m._sphericalEnd.radius,r=m._sphericalEnd.radius;if(m.dolly(a),m.dollyToCursor&&m.object.isCamera){var n=m._sphericalEnd.radius-r;b.set(e,i),w.setFromCamera(b,m.object);var s=w.ray.direction.angleTo(A.setFromSpherical(m._sphericalEnd)),h=r/-Math.cos(s);w.ray.at(h,A),m._targetEnd.lerp(A,-n/m._sphericalEnd.radius),m._target.copy(m._targetEnd)}}else m.object.isOrthographicCamera&&(m.object.zoom=Math.max(m.minZoom,Math.min(m.maxZoom,m.object.zoom*o)),m.object.updateProjectionMatrix(),m._needsUpdate=!0)},m=o,g=new E.Vector2,_=new E.Vector2,v=void 0;o.domElement.addEventListener("mousedown",a),o.domElement.addEventListener("touchstart",r),o.domElement.addEventListener("wheel",n),o.domElement.addEventListener("contextmenu",s),o._removeAllEventListeners=function(){m.domElement.removeEventListener("mousedown",a),m.domElement.removeEventListener("touchstart",r),m.domElement.removeEventListener("wheel",n),m.domElement.removeEventListener("contextmenu",s),document.removeEventListener("mousemove",c),document.removeEventListener("touchmove",c),document.removeEventListener("mouseup",p),document.removeEventListener("touchend",p)}}return o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(y,f),y.install=function(t){E=t.THREE,b=new E.Vector2,A=new E.Vector3,x=new E.Vector3,a=new E.Vector3,r=new E.Vector3,w=new E.Raycaster,M=new E.Spherical,D=new E.Spherical},y.prototype.rotate=function(t,e,i){this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)},y.prototype.rotateTo=function(t,e,i){var o=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));this._sphericalEnd.theta=o,this._sphericalEnd.phi=a,this._sphericalEnd.makeSafe(),i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},y.prototype.dolly=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):this.dollyTo(this._sphericalEnd.radius+t,e)},y.prototype.dollyTo=function(t,e){this.object.isOrthographicCamera?console.warn("dolly is not available for OrthographicCamera"):(this._sphericalEnd.radius=E.Math.clamp(t,this.minDistance,this.maxDistance),e||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0)},y.prototype.pan=function(t,e,i){console.log("`pan` has been renamed to `truck`"),this.truck(t,e,i)},y.prototype.truck=function(t,e,i){this.object.updateMatrix(),a.setFromMatrixColumn(this.object.matrix,0),r.setFromMatrixColumn(this.object.matrix,1),a.multiplyScalar(t),r.multiplyScalar(-e);var o=A.copy(a).add(r);this._targetEnd.add(o),i||this._target.copy(this._targetEnd),this._needsUpdate=!0},y.prototype.forward=function(t,e){A.setFromMatrixColumn(this.object.matrix,0),A.crossVectors(this.object.up,A),A.multiplyScalar(t),this._targetEnd.add(A),e||this._target.copy(this._targetEnd),this._needsUpdate=!0},y.prototype.moveTo=function(t,e,i,o){this._targetEnd.set(t,e,i),o||this._target.copy(this._targetEnd),this._needsUpdate=!0},y.prototype.fitTo=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.object.isOrthographicCamera)console.warn("fitTo is not supported for OrthographicCamera");else{var o=i.paddingLeft||0,a=i.paddingRight||0,r=i.paddingBottom||0,n=i.paddingTop||0,s=t.isBox3?t.clone():(new E.Box3).setFromObject(t),h=s.getSize(A),c=h.x+o+a,p=h.y+n+r,l=h.z,d=this.getDistanceToFit(c,p,l);this.dollyTo(d,e);var u=s.getCenter(A),m=u.x-(.5*o-.5*a),g=u.y+(.5*n-.5*r),_=u.z;this.moveTo(m,g,_,e),this._sanitizeSphericals(),this.rotateTo(0,90*E.Math.DEG2RAD,e)}},y.prototype.setLookAt=function(t,e,i,o,a,r,n){var s=A.set(t,e,i),h=x.set(o,a,r);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(s.sub(h)),this._sanitizeSphericals(),n||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},y.prototype.lerpLookAt=function(t,e,i,o,a,r,n,s,h,c,p,l,d,u){var m=A.set(t,e,i),g=x.set(o,a,r);M.setFromVector3(m.sub(g));var _=A.set(c,p,l);this._targetEnd.copy(g).lerp(_,d);var v=x.set(n,s,h);D.setFromVector3(v.sub(_));var f=D.theta-M.theta,y=D.phi-M.phi,E=D.radius-M.radius;this._sphericalEnd.set(M.radius+E*d,M.phi+y*d,M.theta+f*d),this._sanitizeSphericals(),u||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},y.prototype.setPosition=function(t,e,i,o){this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,o)},y.prototype.setTarget=function(t,e,i,o){var a=this.getPosition(A);this.setLookAt(a.x,a.y,a.z,t,e,i,o)},y.prototype.getDistanceToFit=function(t,e,i){var o=this.object,a=t/e,r=o.fov*E.Math.DEG2RAD,n=o.aspect;return.5*(a<n?e:t/n)/Math.tan(.5*r)+.5*i},y.prototype.getTarget=function(t){return(t&&t.isVector3?t:new E.Vector3).copy(this._targetEnd)},y.prototype.getPosition=function(t){return(t&&t.isVector3?t:new E.Vector3).setFromSpherical(this._sphericalEnd).add(this._targetEnd)},y.prototype.reset=function(t){this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t)},y.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this.object.position),this._zoom0=this.object.zoom},y.prototype.update=function(t){var e=this._state===j?this.dampingFactor:this.draggingDampingFactor,i=1-Math.exp(-e*t/.016),o=this._sphericalEnd.theta-this._spherical.theta,a=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,n=A.subVectors(this._targetEnd,this._target);Math.abs(o)>h||Math.abs(a)>h||Math.abs(r)>h||Math.abs(n.x)>h||Math.abs(n.y)>h||Math.abs(n.z)>h?(this._spherical.set(this._spherical.radius+r*i,this._spherical.phi+a*i,this._spherical.theta+o*i),this._target.add(n.multiplyScalar(i)),this._needsUpdate=!0):(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd)),this._spherical.makeSafe(),this.object.position.setFromSpherical(this._spherical).add(this._target),this.object.lookAt(this._target);var s=this._needsUpdate;return this._needsUpdate=!1,s&&this.dispatchEvent({type:"update"}),s},y.prototype.toJSON=function(){return JSON.stringify({enabled:this.enabled,minDistance:this.minDistance,maxDistance:e(this.maxDistance),minPolarAngle:this.minPolarAngle,maxPolarAngle:e(this.maxPolarAngle),minAzimuthAngle:e(this.minAzimuthAngle),maxAzimuthAngle:e(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:this.object.position.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray()})},y.prototype.fromJSON=function(t,e){var i=JSON.parse(t),o=(new E.Vector3).fromArray(i.position);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=n(i.maxDistance),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=n(i.maxPolarAngle),this.minAzimuthAngle=n(i.minAzimuthAngle),this.maxAzimuthAngle=n(i.maxAzimuthAngle),this.dampingFactor=i.dampingFactor,this.draggingDampingFactor=i.draggingDampingFactor,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._targetEnd.fromArray(i.target),this._sphericalEnd.setFromVector3(o.sub(this._target0)),e||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},y.prototype.dispose=function(){this._removeAllEventListeners()},y.prototype._sanitizeSphericals=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%(2*Math.PI),this._spherical.theta+=2*Math.PI*Math.round((this._sphericalEnd.theta-this._spherical.theta)/(2*Math.PI))},y}(t)});
